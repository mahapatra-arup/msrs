<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bing Auto Search</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha384-KyZXEAg3QhqLMpG8r+Knujsl5/0AKtxdyz5W6WLO6t6tqRzXlT89N79tOG6Lk5+f" crossorigin="anonymous"></script>

    <!-- jQuery Mobile CSS -->
    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
    <!-- jQuery Mobile JS -->
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
</head>

<body class="bg-light py-5">

    <div class="container">
        <div id="div-settings" class="card p-4 shadow-sm mx-auto" style="max-width: 500px;">
            <h3 class="text-primary text-center mb-4">Bing Auto Search</h3>

            <div class="mb-3">
                <label for="slc-limit" class="form-label">Search Limit:</label>
                <select id="slc-limit" class="form-select" data-role="slider">
                    <option value="20">20</option>
                    <option value="30" selected>30</option>
                    <option value="35">35</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="slc-interval" class="form-label">Search Interval (ms):</label>
                <select id="slc-interval" class="form-select" data-role="slider">
                    <option value="5000">5 seconds</option>
                    <option value="6000">6 seconds</option>
                    <option value="7000" selected>7 seconds</option>
                    <option value="8000">8 seconds</option>
                    <option value="9000">9 seconds</option>
                    <option value="10000">10 seconds</option>
                    <option value="11000">11 seconds</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="slc-multitab" class="form-label">Open in Multiple Tabs:</label>
                <select id="slc-multitab" class="form-select" data-role="slider">
                    <option value="true">Yes</option>
                    <option value="false">No</option>
                </select>
            </div>

            <div class="mb-4">
                <label for="slc-waitTime" class="form-label">Wait Time Between Cycles (minutes):</label>
                <select id="slc-waitTime" class="form-select" data-role="slider">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                </select>
            </div>

            <div class="d-grid gap-2">
                <a href="#" id="btn-start" class="ui-btn ui-btn-b ui-corner-all">Start Search</a>
                <a href="#" id="btn-stop" class="ui-btn ui-btn-c ui-corner-all" disabled>Stop Search</a>
            </div>

            <span id="span-progress" class="d-block mt-4 text-center">Total searches performed: 0</span>
            <span id="span-countdown" class="d-block mt-2 text-center">Next search in: 0 seconds</span>
            <label class="d-block text-muted text-center mt-3">Version: 2.0</label>
        </div>
    </div>

    <script>
        const BING_AUTOSEARCH = {
            elements: {
                button: {
                    start: $("#btn-start"),
                    stop: $("#btn-stop")
                },
                select: {
                    limit: $("#slc-limit"),
                    interval: $("#slc-interval"),
                    multitab: $("#slc-multitab"),
                    waitTime: $("#slc-waitTime")
                },
                span: {
                    progress: $("#span-progress"),
                    countdown: $("#span-countdown")
                }
            },
            search: {
                limitCycle: 4,
                limit: 20,
                currentTotalSearches: 0,
                interval: 10000,
                multitab: true,
                intervalId: null,
                countdownId: null,
                previousTab: null,
                engine: {
                    terms: {
                        lists: [
                            ["text1", "text2"]
                        ]
                    },
                    form: [
                        "QBLH", "QBRE", "HDRSC1", "LGWQS1", "LGWQS2", "LGWQS3",
                        "R5FD", "QSRE1", "QSRE2", "QSRE3", "QSRE4", "QSRE5"
                    ],
                    getRandomForm: function () {
                        return this.form[Math.floor(Math.random() * this.form.length)];
                    }
                },
                generateRandomLetterString: function (length) {
                    const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz123';
                    return Array.from({ length }, () => letters.charAt(Math.floor(Math.random() * letters.length))).join('');
                },
                runSearchCycle: function () {
                    let currentSearchCount = 0;

                    this.performSearch();
                    currentSearchCount++;
                    this.currentTotalSearches++;

                    BING_AUTOSEARCH.elements.span.progress.text(`Total searches performed: ${this.currentTotalSearches}`);

                    this.updateCountdown(this.interval);

                    this.intervalId = setInterval(() => {
                        if (currentSearchCount >= this.limitCycle || this.currentTotalSearches >= this.limit) {
                            clearInterval(this.intervalId);
                            clearInterval(this.countdownId);
                            if (this.currentTotalSearches < this.limit) {
                                const waitTimeMinutes = parseInt(BING_AUTOSEARCH.elements.select.waitTime.val(), 10);
                                const waitTimeMs = waitTimeMinutes * 60 * 1000;

                                setTimeout(() => {
                                    this.runSearchCycle();
                                }, waitTimeMs);
                            } else {
                                console.log("Total search limit reached. Stopping the process.");
                            }
                        } else {
                            this.performSearch();
                            currentSearchCount++;
                            this.currentTotalSearches++;

                            BING_AUTOSEARCH.elements.span.progress.text(`Total searches performed: ${this.currentTotalSearches}`);
                            this.updateCountdown(this.interval);
                        }
                    }, this.interval);
                },
                performSearch: function () {
                    if (!navigator.onLine) {
                        console.log("No internet connection. Pausing search...");
                        return;
                    }

                    const randomSearchTerm = this.generateRandomLetterString(7);
                    const randomForm = this.engine.getRandomForm();
                    const searchUrl = `https://www.bing.com/search?q=${encodeURIComponent(randomSearchTerm)}&qs=n&form=${randomForm}`;

                    try {
                        console.log(`Searching for: ${randomSearchTerm} with FORM=${randomForm}`);
                        if (this.previousTab) {
                            this.previousTab.close();
                        }

                        this.previousTab = window.open(searchUrl, '_blank');
                        if (!this.previousTab) {
                            throw new Error("Pop-up blocked. Please allow pop-ups.");
                        }

                        window.focus();
                    } catch (error) {
                        console.error("Error opening tab: ", error);
                    }
                },
                updateCountdown: function (intervalMs) {
                    let countdownValue = Math.floor(intervalMs / 1000);
                    const countdownDisplay = BING_AUTOSEARCH.elements.span.countdown;

                    if (this.countdownId) {
                        clearInterval(this.countdownId);
                    }

                    this.countdownId = setInterval(() => {
                        countdownDisplay.text(`Next search in: ${countdownValue} seconds`);
                        if (countdownValue <= 0) {
                            clearInterval(this.countdownId);
                        }
                        countdownValue--;
                    }, 1000);
                },
                stopSearch: function () {
                    clearInterval(this.intervalId);
                    clearInterval(this.countdownId);
                    console.log("Search process stopped.");
                }
            }
        };

        BING_AUTOSEARCH.elements.button.start.on("click", function () {
            BING_AUTOSEARCH.elements.button.start.attr("disabled", true);
            BING_AUTOSEARCH.elements.button.stop.attr("disabled", false);
            BING_AUTOSEARCH.search.limit = parseInt(BING_AUTOSEARCH.elements.select.limit.val(), 10);
            BING_AUTOSEARCH.search.interval = parseInt(BING_AUTOSEARCH.elements.select.interval.val(), 10);
            BING_AUTOSEARCH.search.multitab = BING_AUTOSEARCH.elements.select.multitab.val() === "true";

            BING_AUTOSEARCH.search.runSearchCycle();
        });

        BING_AUTOSEARCH.elements.button.stop.on("click", function () {
            BING_AUTOSEARCH.search.stopSearch();
            BING_AUTOSEARCH.elements.button.start.attr("disabled", false);
            BING_AUTOSEARCH.elements.button.stop.attr("disabled", true);
        });
    </script>
</body>

</html>
